"use strict";!function(e){function t(e,t){return n=>{n.innerHTML="";const o=document.createElement("ul");o.className="tttie-extension-list",t.forEach(t=>{const n=document.createElement("li"),i=document.createElement("label"),c=document.createElement("input");c.id=t.id,c.type="checkbox",c.name=e?"tttie-channels":"tttie-roles",i.htmlFor=t.id,i.innerText=(e?"#":"")+t.name,n.appendChild(c),n.appendChild(i),o.appendChild(n)}),n.appendChild(o)}}let n=!1;function o(t){const n=[];for(const e of document.querySelectorAll("div.tttie-extension-channel-list"))e.querySelectorAll('input[name="tttie-channels"]').forEach(e=>{e.checked&&n.push(e.id)});const o=[];for(var i of document.querySelectorAll("div.tttie-extension-role-list"))i.querySelectorAll('input[name="tttie-roles"]').forEach(e=>{e.checked&&o.push(e.id)});const c=document.querySelector("input#tttie-extension-store-id");"new"===ttbot.extension||c.value||t(!1);const a=document.querySelector("input#tttie-extension-cmd");let l;(!a.value||a.value.includes(" ")||a.value.length>20)&&t(!1);const r=document.querySelector("textarea#tttie-textarea-code");l=!r&&document.querySelector("div.monaco-container#extension-monaco-container")?e.ttbot.editor.getValue():r.value;const d=document.querySelector("input#tttie-extension-name");(!d.value||d.value.length>100)&&t(!1),t({allowedChannels:n,allowedRoles:o,commandTrigger:a.value,code:l,name:d.value,store:c.value||null})}function i(t,n,o){n&&o||("new"===t.id?document.title+=" - New extension":document.title+=" - Extension: "+t.name);const i=document.querySelector("h1#tttie-title");"new"===t.id?i.innerText="Create a new extension":i.innerText="Extension: "+t.name,document.querySelector("input#tttie-extension-name").value=t.name;for(const e of document.querySelectorAll("div.tttie-extension-channel-list"))e.querySelectorAll('input[name="tttie-channels"]').forEach(e=>{t.allowedChannels.includes(e.id)?e.checked=!0:e.checked=!1});for(const e of document.querySelectorAll("div.tttie-extension-role-list"))e.querySelectorAll('input[name="tttie-roles"]').forEach(e=>{t.allowedRoles.includes(e.id)?e.checked=!0:e.checked=!1});if(document.querySelector("input#tttie-extension-store-id").value=t.store,document.querySelector("input#tttie-extension-cmd").value=t.commandTrigger,n){const n=document.querySelector("textarea#tttie-textarea-code");!n&&document.querySelector("div.monaco-container#extension-monaco-container")?e.ttbot.editor.setValue(t.code):n.value=t.code}}var c,a;window.addEventListener("load",()=>{const l=document.querySelectorAll("div.tttie-extension-channel-list"),r=document.querySelectorAll("div.tttie-extension-role-list");e.ttbot.getAvailableChannels().then(n=>(l.forEach(t(!0,n)),e.ttbot.getAvailableRoles(!0))).then(n=>(r.forEach(t(!1,n.filter(t=>t.id!==e.ttbot.guildId))),e.ttbot.getExtension())).then(t=>{const l=document.querySelector("textarea#tttie-textarea-code");if(!l&&document.querySelector("div.monaco-container#extension-monaco-container")){function r(){fetch("/tt.bot.d.ts").then(e=>e.text()).then(n=>{e.monaco.languages.typescript.javascriptDefaults.addExtraLib(n),e.ttbot.editor=e.monaco.editor.create(document.querySelector("div.monaco-container#extension-monaco-container"),{value:t.code,language:"javascript",theme:"vs-dark"}),e.addEventListener("resize",function(){e.ttbot.editor.layout({height:600,width:document.body.clientWidth>650?650:350})})})}const n=function(){if(e.ttbot.monacoLoaded)return r();setTimeout(n,100)};e.ttbot.monacoLoaded?r():setTimeout(n,100)}else l.value=t.code;i(t),function(t,o,i){t.addEventListener("click",()=>{if(n)return!1;n=!0;var c=t.innerHTML;t.innerText="Saving...";var a=e.ttbot.extensionData;i(i=>{const l=(i,a)=>{t.innerHTML=c,n=!1,o(e.ttbot.extensionData,i,a)};i?e.ttbot.updateExtension(i).then(()=>l(!1,!0)).then(()=>{if("new"===e.ttbot.extension)e.location="/dashboard/"+e.ttbot.guildId+"/extensions/"+e.ttbot.extensionData.id+(e.ttbot.editor?"/monaco":"");else{if(a.name===e.ttbot.extensionData.name)return;e.location.reload()}}):l(!0,!1)})})}(document.querySelector("a.tttie-linkbutton#save"),i,o),c=document.querySelector("a.tttie-linkbutton#reset"),a=(e=>{i(e,!0)}),c.addEventListener("click",()=>{a(e.ttbot.extensionData,!0)})})})}(window);