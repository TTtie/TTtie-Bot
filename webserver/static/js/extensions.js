"use strict";!function(e){const t={httpRequests:1,guildSettings:2,dangerousGuildSettings:4,guildModerative:8,guildMembersMeta:16,mentionEveryone:32};(e.__loadMonaco||(t=>e.addEventListener("load",t)))(function(){function n(e,t){return n=>{n.innerHTML="",t.forEach(t=>{const o=document.createElement("div");o.className="control";const i=document.createElement("label");i.className="checkbox";const l=document.createElement("span"),c=document.createElement("input");c.id=t.id,c.type="checkbox",c.name=e?"tttie-channels":"tttie-roles",l.innerText=(e?"#":"")+t.name,i.append(c,l),o.appendChild(i),n.appendChild(o)})}}let o=!1;function i(n){const o=[];for(const e of document.querySelectorAll("div.tttie-extension-channel-list"))e.querySelectorAll('input[name="tttie-channels"]').forEach(e=>{e.checked&&o.push(e.id)});const i=[];for(var l of document.querySelectorAll("div.tttie-extension-role-list"))l.querySelectorAll('input[name="tttie-roles"]').forEach(e=>{e.checked&&i.push(e.id)});let c=0;document.querySelectorAll("input.tttie-extension-flags").forEach(e=>{Object.prototype.hasOwnProperty.call(t,e.id)&&e.checked&&(c|=t[e.id])});const a=document.querySelector("input#tttie-extension-store-id");"new"===ttbot.extension||a.value||n(!1);const s=document.querySelector("input#tttie-extension-cmd");let r;(!s.value||s.value.includes(" ")||s.value.length>20)&&n(!1);const d=document.querySelector("textarea#tttie-textarea-code");r=!d&&document.querySelector("div.monaco-container#extension-monaco-container")?e.ttbot.editor.getValue():d.value;const u=document.querySelector("input#tttie-extension-name");(!u.value||u.value.length>100)&&n(!1),n({allowedChannels:o,allowedRoles:i,commandTrigger:s.value,code:r,name:u.value,store:a.value||null,flags:c})}function l(n,o,i){o||i||("new"===n.id?document.title+=" - New extension":document.title+=" - Extension: "+n.name);const l=document.querySelectorAll(".tttie-title");for(const e of l)"new"===n.id?e.innerText="New extension":e.innerText=n.name;const c=document.querySelector("input#tttie-extension-name");c.value=n.name,c.parentElement.classList.remove("is-loading");for(const e of document.querySelectorAll("div.tttie-extension-channel-list"))e.querySelectorAll('input[name="tttie-channels"]').forEach(e=>{n.allowedChannels.includes(e.id)?e.checked=!0:e.checked=!1});for(const e of document.querySelectorAll("div.tttie-extension-role-list"))e.querySelectorAll('input[name="tttie-roles"]').forEach(e=>{n.allowedRoles.includes(e.id)?e.checked=!0:e.checked=!1});const a=document.querySelector("input#tttie-extension-store-id");a.value=n.store,a.parentElement.classList.remove("is-loading");const s=document.querySelector("input#tttie-extension-cmd");s.value=n.commandTrigger,s.parentElement.classList.remove("is-loading");const r=document.querySelectorAll("input.tttie-extension-flags"),d=document.createElement("span");d.classList.add("tags","has-addons","is-inline-flex","requires-approval");const u=document.createElement("span");u.classList.add("tag","is-info","is-marginless"),u.innerText="Pending approval";const m=document.createElement("span");m.classList.add("tag","is-info","is-marginless","is-loading"),d.append(u,m);for(const e of r){const o=e.parentElement.parentElement.querySelector("span.tags.requires-approval");Object.prototype.hasOwnProperty.call(t,e.id)?n.flags&t[e.id]?(e.checked=!0,o&&o.remove()):n.privilegedFlags&t[e.id]?(e.checked=!0,o||e.parentElement.insertAdjacentElement("afterend",d.cloneNode(!0))):(e.checked=!1,o&&o.remove()):(e.checked=!1,o&&o.remove())}const p=document.querySelector("textarea#tttie-textarea-code");!p&&document.querySelector("div.monaco-container#extension-monaco-container")?e.ttbot.editor.setValue(n.code):(p.value=n.code,p.parentElement.classList.remove("is-loading"))}const c=document.querySelectorAll("div.tttie-extension-channel-list"),a=document.querySelectorAll("div.tttie-extension-role-list");var s,r,d;e.ttbot.getAvailableChannels().then(t=>(c.forEach(n(!0,t)),e.ttbot.getAvailableRoles(!0))).then(t=>(a.forEach(n(!1,t.filter(t=>t.id!==e.ttbot.guildId))),e.ttbot.getExtension())).then(t=>{l(t),s=document.querySelector("button#save"),r=l,d=i,s.addEventListener("click",()=>{if(o)return!1;o=!0,s.classList.add("is-loading"),s.disabled=!0;const t=e.ttbot.extensionData;d(n=>{const i=(t,n)=>{s.classList.remove("is-loading"),s.disabled=!1,o=!1,r(e.ttbot.extensionData,t,n)};n?e.ttbot.updateExtension(n).then(()=>i(!1,!0)).then(()=>{if("new"===e.ttbot.extension)e.location="/dashboard/"+e.ttbot.guildId+"/extensions/"+e.ttbot.extensionData.id+(e.ttbot.editor?"/monaco":"");else{if(t.name===e.ttbot.extensionData.name)return;e.location.reload()}}):i(!0,!1)})}),((t,n)=>{t.addEventListener("click",()=>{n(e.ttbot.extensionData,!0)})})(document.querySelector("button#reset"),e=>{l(e,!0)})})})}(window);